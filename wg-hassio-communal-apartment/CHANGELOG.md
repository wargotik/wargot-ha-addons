# Changelog

Все значимые изменения в этом проекте будут документироваться в этом файле.

Формат основан на [Keep a Changelog](https://keepachangelog.com/ru/1.0.0/),
и этот проект придерживается [Semantic Versioning](https://semver.org/lang/ru/).

## [0.4.6] - 2025-01-28

### Changed
- Переименован аддон: "Коммуналка" → "Utilities Tracker"
- Обновлены README файлы на английский язык
- Обновлено описание аддона

## [0.4.5] - 2025-01-28

### Changed
- Добавлен endpoint `/api/sensors` для получения агрегированных данных сенсоров через REST API

## [0.4.4] - 2025-01-27

### Fixed
- Исправлена авторизация при запросе к Home Assistant API: используется заголовок `X-Supervisor-Token` вместо `Authorization: Bearer`
- Добавлено логирование тела ответа от HA API для диагностики ошибок

## [0.4.3] - 2025-01-27

### Added
- Добавлено подробное логирование запросов на получение настроек Home Assistant (валюта и язык)
- Логирование включает информацию о наличии SUPERVISOR_TOKEN, статусе запроса к HA API и полученных значениях

## [0.4.2] - 2025-01-27

### Fixed
- Исправлена ошибка с экранированием апострофов в переводах (украинский, белорусский языки)
- Переводы вынесены в отдельные JSON файлы вместо хранения в JavaScript коде
- Добавлен endpoint `/api/translations` для загрузки переводов

### Changed
- Переводы теперь загружаются динамически через API вместо статического объекта в коде
- Улучшена обработка ошибок при загрузке переводов с fallback на английский язык

## [0.4.1] - 2025-01-27

### Changed
- Убран `map: ["config:rw"]` из конфигурации для повышения рейтинга безопасности
- Обновлен README: добавлены иконки архитектур и GitHub Release

## [0.4.0] - 2025-01-27

### Added
- Добавлена поддержка получения валюты из настроек Home Assistant
- Добавлена поддержка получения языка из настроек Home Assistant
- Добавлена мультиязычная поддержка: английский, русский, украинский, польский, белорусский
- Добавлен endpoint `/api/config` для получения конфигурации (валюта и язык)
- Добавлены переводы для всех текстов UI на всех поддерживаемых языках
- Добавлены переводы сообщений об ошибках на всех языках
- Создан модуль `translations.py` для управления переводами типов платежей

### Changed
- Изменена структура `PAYMENT_TYPES`: теперь используется словарь с числовыми ключами (1, 2, 3) вместо строковых
- Удалена таблица `payment_types` из базы данных
- В таблице `payments` поле `payment_type_id` теперь хранит ID из константы `PAYMENT_TYPES` вместо внешнего ключа
- Убрана зависимость от таблицы `payment_types` в базе данных
- Дефолтный язык изменен с русского на английский
- Форматирование сумм теперь использует валюту из настроек Home Assistant
- Обновлена интеграция Home Assistant для работы с новой структурой данных

### Removed
- Удалена таблица `payment_types` из базы данных
- Удалены все методы работы с `payment_types` из `database.py`
- Убрана зависимость FOREIGN KEY из таблицы `payments`

## [0.3.8] - 2025-01-27

### Added
- Добавлена поддержка получения валюты из настроек Home Assistant
- Добавлена поддержка получения языка из настроек Home Assistant
- Добавлена мультиязычная поддержка: английский, русский, украинский, польский, белорусский
- Добавлен endpoint `/api/config` для получения конфигурации (валюта и язык)
- Добавлены переводы для всех текстов UI на всех поддерживаемых языках
- Добавлены переводы сообщений об ошибках на всех языках

### Changed
- Изменена структура `PAYMENT_TYPES`: теперь используется словарь с числовыми ключами (1, 2, 3) вместо строковых
- Удалена таблица `payment_types` из базы данных
- В таблице `payments` поле `payment_type_id` теперь хранит ID из константы `PAYMENT_TYPES` вместо внешнего ключа
- Убрана зависимость от таблицы `payment_types` в базе данных
- Дефолтный язык изменен с русского на английский
- Форматирование сумм теперь использует валюту из настроек Home Assistant

### Removed
- Удалена таблица `payment_types` из базы данных
- Удалены все методы работы с `payment_types` из `database.py`
- Убрана зависимость FOREIGN KEY из таблицы `payments`

## [0.3.7] - 2025-01-26

### Changed
- Добавлена валидация поля "Объём": теперь объём должен быть обязательно больше нуля
- Функция `calculateVolume()` не устанавливает значение 0, если объём равен нулю
- Добавлена проверка объёма на фронтенде перед отправкой формы
- Добавлена проверка объёма на бэкенде при сохранении оплаты

## [0.3.6] - 2025-01-25

### Changed
- Удалён параметр `currency` из конфигурации add-on'а
- На UI вместо названия валюты отображается иконка `mdi:cash`
- Суммы отображаются в числовом формате без указания валюты

### Removed
- Удалён API endpoint `/api/config`
- Удалена логика загрузки и валидации валюты из конфигурации
- Удалена функция `load_config()` и `validate_currency()` из `main.py`

## [0.3.5] - 2025-01-24

### Changed
- Поле `currency` возвращено к текстовому вводу с подсказкой о формате ISO 4217
- Добавлена ссылка на официальный список кодов валют ISO 4217 в описании поля
- Добавлена валидация кода валюты при загрузке конфигурации (формат: 3 заглавные буквы)
- При невалидном коде валюты используется значение по умолчанию (EUR) с предупреждением в логах

## [0.3.4] - 2025-01-23

### Changed
- Поле `currency` в конфигурации изменено на выпадающий список с вариантами валют
- Добавлены варианты: Евро, Доллар, Российский рубль, Украинская гривна, Злотый, Белорусский рубль
- По умолчанию установлено значение "Евро" (EUR)

## [0.3.3] - 2025-01-22

### Added
- Добавлен файл CHANGELOG.md для отслеживания изменений проекта

## [0.3.2] - 2025-01-21

### Added
- Добавлено использование параметра `currency` из конфигурации add-on'а на UI
- Добавлен API endpoint `/api/config` для получения конфигурации
- Суммы на UI теперь отображаются в валюте, указанной в конфигурации

## [0.3.1] - 2025-01-20

### Changed
- Автоматическая подстановка текущей даты при открытии модального окна добавления оплаты
- Период стал необязательным полем и автоматически рассчитывается на основе даты оплаты
- Период перенесён в правую колонку (необязательные поля)
- Поле "Заметки" изменено с input на textarea
- Поле "Дата оплаты" размещено выше поля "Сумма" в форме

### Fixed
- Backend автоматически вычисляет период из даты оплаты, если период не указан

## [0.3.0] - 2025-01-19

### Changed
- Восстановлен веб-сервер для UI (без внешних HTTP-запросов)
- Восстановлены настройки ingress для доступа к веб-интерфейсу

### Removed
- Удалены внешние HTTP-запросы к сторонним сайтам
- Удалён модуль `ozon_api.py`
- Удалён модуль `storage.py`

## [0.2.9] - 2025-01-18

### Removed
- Удалён параметр `site` из конфигурации и его использование
- Удалён `aiohttp` из зависимостей (позже восстановлен для веб-сервера)

## [0.2.6] - 2025-01-17

### Added
- Добавлены Home Assistant сенсоры для интеграции с панелью "Энергия"
- Добавлен расчёт и сохранение `unit_price` (стоимость за единицу) при добавлении оплаты
- Добавлено отображение `unit_price` в UI списка платежей
- Добавлен параметр `currency` в конфигурацию add-on'а (по умолчанию `EUR`)

### Fixed
- Исправлены сенсоры для корректной работы с панелью "Энергия" Home Assistant
- Исправлен доступ к полям `sqlite3.Row` объектов

## [0.2.1] - 2025-01-16

### Added
- Добавлены поля "Предыдущее показание счётчика" и "Текущее показание счётчика"
- Добавлен автоматический расчёт объёма на основе показаний счётчика
- Добавлено сохранение объёма в базу данных

### Changed
- Переработан UI модального окна добавления оплаты: два столбца (обязательные слева, необязательные справа)
- Поле "Тип оплаты" теперь использует константы (Электроэнергия, Газ, Вода) вместо базы данных
- Обновлены иконки: `mdi:cash-multiple` для заголовка, `mdi:pencil-plus` для кнопки добавления

### Removed
- Удалена кнопка "Парсить все товары" и связанный функционал

## [0.2.0] - 2025-01-15

### Changed
- Проект переименован с "Ozon" на "Коммунальные платежи"
- Изменена структура базы данных: добавлены таблицы `payments` и `payment_types`
- UI изменён: "Товары из базы" → "Оплаты", "Добавить товар" → "Добавить оплату"

### Added
- Добавлена таблица `payment_types` с полями: `id`, `name`, `system_name`, `description`, `is_active`, `is_system`
- Добавлена таблица `payments` с полями: `id`, `payment_type_id`, `amount`, `payment_date`, `period`, `receipt_number`, `payment_method`, `notes`, `created_at`, `updated_at`

## [0.1.x] - 2025-01-14

### Added
- Начальная версия add-on для отслеживания товаров Ozon
- Базовая структура add-on с веб-интерфейсом
- Интеграция с базой данных SQLite
- Функционал парсинга страниц товаров Ozon

---

[0.4.6]: https://github.com/wargotik/wargot-ha-addons/compare/v0.4.5...v0.4.6
[0.4.5]: https://github.com/wargotik/wargot-ha-addons/compare/v0.4.4...v0.4.5
[0.4.4]: https://github.com/wargotik/wargot-ha-addons/compare/v0.4.3...v0.4.4
[0.4.3]: https://github.com/wargotik/wargot-ha-addons/compare/v0.4.2...v0.4.3
[0.4.2]: https://github.com/wargotik/wargot-ha-addons/compare/v0.4.1...v0.4.2
[0.4.1]: https://github.com/wargotik/wargot-ha-addons/compare/v0.4.0...v0.4.1
[0.4.0]: https://github.com/wargotik/wargot-ha-addons/compare/v0.3.8...v0.4.0
[0.3.8]: https://github.com/wargotik/wargot-ha-addons/compare/v0.3.7...v0.3.8
[0.3.7]: https://github.com/wargotik/wargot-ha-addons/compare/v0.3.6...v0.3.7
[0.3.6]: https://github.com/wargotik/wargot-ha-addons/compare/v0.3.5...v0.3.6
[0.3.5]: https://github.com/wargotik/wargot-ha-addons/compare/v0.3.4...v0.3.5
[0.3.4]: https://github.com/wargotik/wargot-ha-addons/compare/v0.3.3...v0.3.4
[0.3.3]: https://github.com/wargotik/wargot-ha-addons/compare/v0.3.2...v0.3.3
[0.3.2]: https://github.com/wargotik/wargot-ha-addons/compare/v0.3.1...v0.3.2
[0.3.1]: https://github.com/wargotik/wargot-ha-addons/compare/v0.3.0...v0.3.1
[0.3.0]: https://github.com/wargotik/wargot-ha-addons/compare/v0.2.9...v0.3.0
[0.2.9]: https://github.com/wargotik/wargot-ha-addons/compare/v0.2.6...v0.2.9
[0.2.6]: https://github.com/wargotik/wargot-ha-addons/compare/v0.2.1...v0.2.6
[0.2.1]: https://github.com/wargotik/wargot-ha-addons/compare/v0.2.0...v0.2.1
[0.2.0]: https://github.com/wargotik/wargot-ha-addons/compare/v0.1.x...v0.2.0

