#include <tunables/global>

profile alarmme flags=(attach_disconnected,mediate_deleted) {
  #include <abstractions/base>
  
  # Network access for Home Assistant API and web server
  network,
  capability net_bind_service,
  
  # File system access - data directory (full read/write access)
  /data/** rw,
  /data/ rw,
  
  # Application files - full access for Python
  /app/** rmix,
  
  # Config access
  /config.json r,
  /data/options.json r,
  
  # Python interpreter and libraries - simplified, more permissive
  /usr/bin/python* ix,
  /usr/local/bin/python* ix,
  
  # Python standard library and all Python files - broad access
  /usr/local/lib/python3*/** rmix,
  /usr/lib/python3*/** rmix,
  /usr/local/lib/python3*.zip rm,
  /usr/lib/python3*.zip rm,
  
  # Python shared libraries - all architectures
  /usr/lib/**/libpython*.so* rm,
  /usr/local/lib/**/libpython*.so* rm,
  /lib/**/libpython*.so* rm,
  
  # Standard system libraries
  /lib/** rm,
  /lib64/** rm,
  /usr/lib/** rm,
  
  # Tini (init system)
  /usr/bin/tini ix,
  /sbin/tini ix,
  
  # Process and network information
  owner @{PROC}/[0-9]*/** r,
  /proc/** r,
  
  # Logging
  /var/log/** w,
  
  # Temporary files
  /tmp/** rw,
  /var/tmp/** rw,
  
  # System configuration (minimal)
  /etc/passwd r,
  /etc/group r,
  /etc/nsswitch.conf r,
  /etc/hosts r,
  /etc/resolv.conf r,
  
  # System information (read-only)
  /sys/** r,
  
  # Deny only most sensitive files
  deny /etc/shadow r,
  deny /root/** r,
}

